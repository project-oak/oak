<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="google-signin-client_id"
      content="691249393555-anhtgr54cajv9l96apgfi3hv1n3a63e2.apps.googleusercontent.com"
    />

    <title>Oak emulator</title>
    <link
      rel="stylesheet"
      href="//fonts.googleapis.com/css?family=Roboto:400,500,700,400italic|Material+Icons"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic|Material+Icons"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/vue-material/dist/vue-material.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/vue-material/dist/theme/default.css"
    />
    <script
      src="https://apis.google.com/js/api.js"
      async
      defer
      onload="handleClientLoad()"
    ></script>
  </head>

  <body>
    <div id="app">
      <p>In order to load an Oak Module, press the button below.</p>
      <p>
        This should be a single Wasm file (i.e. not a complete Oak Application).
      </p>
      <p>
        If compiled from Rust, it will usually be under the
        <code>target/wasm32-unknown-unknown</code> folder or similar (preferably
        a debug build, in order to enable sourcemap support)
      </p>
      <p>
        Once loaded, open the Chrome dev tools, navigate to the Sources tab, and
        find the source (Rust) file to debug; set a breakpoint where desired
        (e.g. near an entrypoint definition) and then press on the Invoke button
        for the relevant entrypoint (a module may have more than one entrypoint
        available)
      </p>
      <div>
        <div class="g-signin2" data-onsuccess="onSignIn"></div>
      </div>
      <input
        type="file"
        accept=".wasm"
        id="file-input"
        v-on:change="readFile"
      />
      <div v-if="module">
        <p>Module loaded.</p>
        <p>Imports:</p>
        <ul>
          <li v-for="i in imports">
            <code>{{ i.module }}.{{ i.name }}</code> [{{ i.kind }}]
          </li>
        </ul>
        <p>Exports:</p>
        <ul>
          <li v-for="e in exports">
            <code>{{ e.name }}</code> [{{ e.kind }}]
            <button
              type="button"
              v-if='e.kind == "function"'
              v-on:click="invoke(e.name)"
            >
              invoke
            </button>
          </li>
        </ul>
        <p>Channels:</p>
        <ul>
          <li v-for="(c, handle) in channels">
            <code>[{{handle}}] {{ c }}</code>
          </li>
        </ul>
        <p>Oak ABI call trace:</p>
        <button type="button" v-on:click="reset()">reset</button>
        <ul>
          <li v-for="e in trace">
            <pre>{{ e }}</pre>
          </li>
        </ul>
      </div>
    </div>
    <script defer src="/index.js"></script>
    <script>
      var GoogleAuth;
      function handleClientLoad() {
        // Load the API's client and auth2 modules.
        // Call the initClient function after the modules load.
        gapi.load('client:auth2', initClient);
      }
      function initClient() {
        gapi.client
          .init({
            apiKey: 'YOUR_API_KEY',
            clientId:
              '691249393555-anhtgr54cajv9l96apgfi3hv1n3a63e2.apps.googleusercontent.com',
            scope: 'https://www.googleapis.com/auth/calendar.readonly',
          })
          .then(function () {
            GoogleAuth = gapi.auth2.getAuthInstance();
          });
      }
      initClient();
    </script>
  </body>
</html>
