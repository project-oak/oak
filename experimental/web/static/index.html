<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />

  <title>Oak emulator</title>
  <link rel="preload" href="./index.js" />
  <link rel="preload" href="https://apis.google.com/js/api.js" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,500,700,400italic|Material+Icons" />
  <link rel="stylesheet" href="./vue-material.min.css" />
  <link rel="stylesheet" href="./vue-material-theme.default-dark.css" />
  <link rel="stylesheet" href="./vue-material-theme.default-dark.css" />
  <style>
    :root {
      --md-theme-default-background-variant: hsl(0deg 3% 14%);
      --md-theme-default-background: hsl(0deg 3% 21%);
    }

    html {
      transition: initial;
    }

    #app {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .card-list {
      list-style-type: none;
      padding: 0;
    }

    .card-list-item {
      margin-bottom: 15px;
    }

    .md-title {
      font-size: 22px;
      font-weight: 500 !important;
    }

    .md-card {
      border-radius: 4px;
      box-shadow: 0px 4px 2px -2px rgba(0, 0, 0, 0.3),
        0px 2px 2px 0px rgba(0, 0, 0, 0.15),
        0px 2px 4px 0px rgba(0, 0, 0, 0.12);
    }
  </style>
</head>

<body>
  <div>
    <button id="authorize-button">Authorize</button>
    <button id="signout-button">Sign Out</button>
  </div>
  <div id="app">Please authorize the treehouse application. :)</div>
  <script type="text/x-template" id="app-template">
      <div id="app">
        <input type="checkbox" id="debug" v-model="debug" />
        <label for="debug">debug</label>
        <div v-if="debug">
          <p>In order to load an Oak Module, press the button below.</p>
          <p>
            This should be a single Wasm file (i.e. not a complete Oak
            Application).
          </p>
          <p>
            If compiled from Rust, it will usually be under the
            <code>target/wasm32-unknown-unknown</code> folder or similar
            (preferably a debug build, in order to enable sourcemap support)
          </p>
          <p>
            Once loaded, open the Chrome dev tools, navigate to the Sources tab,
            and find the source (Rust) file to debug; set a breakpoint where
            desired (e.g. near an entrypoint definition) and then press on the
            Invoke button for the relevant entrypoint (a module may have more than
            one entrypoint available)
          </p>
          <form v-on:submit.prevent="readFile()">
            <div>
              <label for="url">
                Enter the URL of the Oak Module (compiled as a Wasm file)
              </label>
            </div>
            <div>
              <input v-model="url" type="url" name="url" id="url" size="70" />
              <button type="submit">Load Module</button>
            </div>
          </form>
          <div v-if="module">
            <p>Module loaded.</p>
            <p>Imports:</p>
            <ul>
              <li v-for="i in imports">
                <code>{{ i.module }}.{{ i.name }}</code> [{{ i.kind }}]
              </li>
            </ul>
            <p>Exports:</p>
            <ul>
              <li v-for="e in exports">
                <code>{{ e.name }}</code> [{{ e.kind }}]
                <button
                  type="button"
                  v-if='e.kind == "function"'
                  v-on:click="invoke(e.name)"
                >
                  invoke
                </button>
              </li>
            </ul>
            <p>Channels:</p>
            <ul>
              <li v-for="(c, handle) in channels">
                <code>[{{handle}}] {{ c }}</code>
              </li>
            </ul>
            <p>Oak ABI call trace:</p>
            <button type="button" v-on:click="reset()">reset</button>
            <ul>
              <li v-for="e in trace">
                <pre>{{ e }}</pre>
              </li>
            </ul>
          </div>
        </div>
        <div>
          <div>
            <p>Cards:</p>
            <ul class="card-list">
              <li class="card-list-item" v-for="card in cards">
                <md-card>
                  <md-card-header>
                    <div class="md-title">{{ card.title }}</div>
                  </md-card-header>
                  <md-card-content> {{ card.start_time }}-{{ card.end_time }} </md-card-content>
                  <md-card-content> {{ card.description }} </md-card-content>
                  <li v-for="photoUrl in card.photos">
                    <md-card-media md-ratio="16:9">
                      <img v-bind:src="photoUrl" alt="" />
                    </md-card-media>
                  </li>
                </md-card>
              </li>
            </ul>
          </div>
          <div>
            <div>
              <h2>Allowed HTTP requests</h2>
              <ul>
                <li v-for="url in allowedUrls">{{ url }}</li>
              </ul>
            </div>
            <div>
              <h2>Denied HTTP requests</h2>
              <ul>
                <li v-for="url in deniedUrls">{{ url }}</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    var GoogleAuth;
    // Load the API's client and auth2 modules.
    // Call the initClient function after the modules load.
    gapi.load('client:auth2', initClient);

    function initClient() {
      gapi.client
        .init({
          clientId:
            '691249393555-anhtgr54cajv9l96apgfi3hv1n3a63e2.apps.googleusercontent.com',
          scope: 'https://www.googleapis.com/auth/calendar.readonly',
        })
        .then(function () {
          GoogleAuth = gapi.auth2.getAuthInstance();
          GoogleAuth.isSignedIn.listen(updateSigninStatus);
          updateSigninStatus(GoogleAuth.isSignedIn.get());
        });
    }

    function updateSigninStatus(isSignedIn) {
      var authorizeButton = document.getElementById('authorize-button');
      var signoutButton = document.getElementById('signout-button');
      authorizeButton.onclick = handleAuthClick;
      signoutButton.onclick = handleSignoutClick;
      if (isSignedIn) {
        authorizeButton.disabled = true;
        signoutButton.disabled = false;
        initTreehouse();
      } else {
        authorizeButton.disabled = false;
        signoutButton.disabled = true;
      }
    }

    function handleAuthClick(event) {
      gapi.auth2.getAuthInstance().signIn();
    }

    function handleSignoutClick(event) {
      gapi.auth2.getAuthInstance().signOut();
    }
  </script>
  <script src="/index.js"></script>
</body>

</html>