<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `Platform` trait in crate `oak_stage0`."><title>Platform in oak_stage0::hal - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-5bc39a1768837dd0.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="oak_stage0" data-themes="" data-resource-suffix="" data-rustdoc-version="1.77.0-nightly (11f32b73e 2024-01-31)" data-channel="nightly" data-search-js="search-dd67cee4cfa65049.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-4c98445ec4002617.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-48f368f3872407c8.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-04d5337699b92874.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../oak_stage0/index.html">oak_stage0</a><span class="version">0.1.0</span></h2></div><h2 class="location"><a href="#">Platform</a></h2><div class="sidebar-elems"><section><h3><a href="#required-associated-types">Required Associated Types</a></h3><ul class="block"><li><a href="#associatedtype.Mmio">Mmio</a></li></ul><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.change_page_state">change_page_state</a></li><li><a href="#tymethod.cpuid">cpuid</a></li><li><a href="#tymethod.deinit_platform">deinit_platform</a></li><li><a href="#tymethod.early_initialize_platform">early_initialize_platform</a></li><li><a href="#tymethod.encrypted">encrypted</a></li><li><a href="#tymethod.get_attestation">get_attestation</a></li><li><a href="#tymethod.get_derived_key">get_derived_key</a></li><li><a href="#tymethod.initialize_platform">initialize_platform</a></li><li><a href="#tymethod.mmio">mmio</a></li><li><a href="#tymethod.page_table_mask">page_table_mask</a></li><li><a href="#tymethod.populate_zero_page">populate_zero_page</a></li><li><a href="#tymethod.port_factory">port_factory</a></li><li><a href="#tymethod.read_msr">read_msr</a></li><li><a href="#tymethod.revalidate_page">revalidate_page</a></li><li><a href="#tymethod.tee_platform">tee_platform</a></li><li><a href="#tymethod.write_msr">write_msr</a></li></ul><h3><a href="#object-safety">Object Safety</a></h3><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In oak_stage0::hal</a></h2></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../oak_stage0/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../index.html">oak_stage0</a>::<wbr><a href="index.html">hal</a>::<wbr><a class="trait" href="#">Platform</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/oak_stage0/hal/mod.rs.html#71-174">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait Platform {
    type <a href="#associatedtype.Mmio" class="associatedtype">Mmio</a>&lt;S: PageSize&gt;: <a class="trait" href="trait.Mmio.html" title="trait oak_stage0::hal::Mmio">Mmio</a>&lt;S&gt;;

<details class="toggle type-contents-toggle"><summary class="hideme"><span>Show 16 methods</span></summary>    // Required methods
    fn <a href="#tymethod.cpuid" class="fn">cpuid</a>(leaf: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u32.html">u32</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/core/core_arch/x86/cpuid/struct.CpuidResult.html" title="struct core::core_arch::x86::cpuid::CpuidResult">CpuidResult</a>;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.mmio" class="fn">mmio</a>&lt;S: PageSize&gt;(base_address: PhysAddr) -&gt; Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.Mmio" title="type oak_stage0::hal::Platform::Mmio">Mmio</a>&lt;S&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.port_factory" class="fn">port_factory</a>() -&gt; <a class="struct" href="struct.PortFactory.html" title="struct oak_stage0::hal::PortFactory">PortFactory</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.early_initialize_platform" class="fn">early_initialize_platform</a>();
<span class="item-spacer"></span>    fn <a href="#tymethod.initialize_platform" class="fn">initialize_platform</a>(e820_table: &amp;[BootE820Entry]);
<span class="item-spacer"></span>    fn <a href="#tymethod.deinit_platform" class="fn">deinit_platform</a>();
<span class="item-spacer"></span>    fn <a href="#tymethod.populate_zero_page" class="fn">populate_zero_page</a>(zero_page: &amp;mut <a class="struct" href="../struct.ZeroPage.html" title="struct oak_stage0::ZeroPage">ZeroPage</a>);
<span class="item-spacer"></span>    fn <a href="#tymethod.get_attestation" class="fn">get_attestation</a>(
        report_data: [<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.array.html">64</a>]
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;AttestationReport, &amp;'static <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.get_derived_key" class="fn">get_derived_key</a>() -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;DerivedKey, &amp;'static <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.change_page_state" class="fn">change_page_state</a>(page: Page&lt;Size4KiB&gt;, state: <a class="enum" href="enum.PageAssignment.html" title="enum oak_stage0::hal::PageAssignment">PageAssignment</a>);
<span class="item-spacer"></span>    fn <a href="#tymethod.revalidate_page" class="fn">revalidate_page</a>(page: Page&lt;Size4KiB&gt;);
<span class="item-spacer"></span>    fn <a href="#tymethod.page_table_mask" class="fn">page_table_mask</a>(encryption_state: <a class="enum" href="../paging/enum.PageEncryption.html" title="enum oak_stage0::paging::PageEncryption">PageEncryption</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.encrypted" class="fn">encrypted</a>() -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.tee_platform" class="fn">tee_platform</a>() -&gt; TeePlatform;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.read_msr" class="fn">read_msr</a>(msr: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u32.html">u32</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.write_msr" class="fn">write_msr</a>(msr: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u32.html">u32</a>, value: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>);
</details>}</code></pre><h2 id="required-associated-types" class="section-header">Required Associated Types<a href="#required-associated-types" class="anchor">§</a></h2><div class="methods"><section id="associatedtype.Mmio" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#72">source</a><h4 class="code-header">type <a href="#associatedtype.Mmio" class="associatedtype">Mmio</a>&lt;S: PageSize&gt;: <a class="trait" href="trait.Mmio.html" title="trait oak_stage0::hal::Mmio">Mmio</a>&lt;S&gt;</h4></section></div><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.cpuid" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#75">source</a><h4 class="code-header">fn <a href="#tymethod.cpuid" class="fn">cpuid</a>(leaf: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u32.html">u32</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/core/core_arch/x86/cpuid/struct.CpuidResult.html" title="struct core::core_arch::x86::cpuid::CpuidResult">CpuidResult</a></h4></section></summary><div class="docblock"><p>Performs the CPUID instruction.</p>
</div></details><section id="tymethod.mmio" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#77">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.mmio" class="fn">mmio</a>&lt;S: PageSize&gt;(base_address: PhysAddr) -&gt; Self::<a class="associatedtype" href="trait.Platform.html#associatedtype.Mmio" title="type oak_stage0::hal::Platform::Mmio">Mmio</a>&lt;S&gt;</h4></section><section id="tymethod.port_factory" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#79">source</a><h4 class="code-header">fn <a href="#tymethod.port_factory" class="fn">port_factory</a>() -&gt; <a class="struct" href="struct.PortFactory.html" title="struct oak_stage0::hal::PortFactory">PortFactory</a></h4></section><details class="toggle method-toggle" open><summary><section id="tymethod.early_initialize_platform" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#91">source</a><h4 class="code-header">fn <a href="#tymethod.early_initialize_platform" class="fn">early_initialize_platform</a>()</h4></section></summary><div class="docblock"><p>Platform-specific early initialization.</p>
<p>This sets up the bare minimum to get things going; for example, under
SEV-ES and above, we set up the GHCB here, but nothing more.</p>
<p>This gets executed very soon after stage0 starts and comes with many
restrictions:</p>
<ul>
<li>You do not have access to logging.</li>
<li>You do not have access to heap allocator (BOOT_ALLOCATOR will still
work).</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.initialize_platform" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#102">source</a><h4 class="code-header">fn <a href="#tymethod.initialize_platform" class="fn">initialize_platform</a>(e820_table: &amp;[BootE820Entry])</h4></section></summary><div class="docblock"><p>Platform-specific intialization.</p>
<p>This gets executed after <code>early_initalize_platform()</code> and some other
auxiliary services, such as logging, have been set up; the main purpose
is to accept all guest memory so that we can set up a heap
allocator.</p>
<p>This does mean you do not have access to the heap allocator
(BOOT_ALLOCATOR will still work).</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.deinit_platform" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#108">source</a><h4 class="code-header">fn <a href="#tymethod.deinit_platform" class="fn">deinit_platform</a>()</h4></section></summary><div class="docblock"><p>Platform-specific cleanups just before stage0 jumps to the kernel.</p>
<p>The assumption is that after this operation there will no longer be any
memory allocations or uses of the logging interface.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.populate_zero_page" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#113">source</a><h4 class="code-header">fn <a href="#tymethod.populate_zero_page" class="fn">populate_zero_page</a>(zero_page: &amp;mut <a class="struct" href="../struct.ZeroPage.html" title="struct oak_stage0::ZeroPage">ZeroPage</a>)</h4></section></summary><div class="docblock"><p>Populates platform-specific information in the zero page.</p>
<p>Example: locations of the SEV Secrets and CPUID pages.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.get_attestation" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#127-129">source</a><h4 class="code-header">fn <a href="#tymethod.get_attestation" class="fn">get_attestation</a>(
    report_data: [<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u8.html">u8</a>; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.array.html">64</a>]
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;AttestationReport, &amp;'static <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>&gt;</h4></section></summary><div class="docblock"><p>Returns an attestation report.</p>
<p>If AMD SEV-SNP is enabled it returns a valid hardware-rooted attestation
report. In other cases it generates an empty attestation report for
testing. The additional data will be set in both cases to bind the
DICE chain to the attestation report.</p>
<h5 id="arguments"><a class="doc-anchor" href="#arguments">§</a>Arguments</h5>
<ul>
<li><code>report_data</code> - The custom data that must be included in the report.
This is typically used to bind information (such as the hash of a
public key) to the report.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.get_derived_key" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#139">source</a><h4 class="code-header">fn <a href="#tymethod.get_derived_key" class="fn">get_derived_key</a>() -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;DerivedKey, &amp;'static <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a>&gt;</h4></section></summary><div class="docblock"><p>Requests a derived key.</p>
<p>The key is derived from the VCEK. The key derivation mixes in the VM
launch measurement and guest policy and uses VMPL0.</p>
<p>We use this key as the unique device secret for deriving compound
devices identifiers for each layer, and eventually a sealing key in
the last layer.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.change_page_state" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#142">source</a><h4 class="code-header">fn <a href="#tymethod.change_page_state" class="fn">change_page_state</a>(page: Page&lt;Size4KiB&gt;, state: <a class="enum" href="enum.PageAssignment.html" title="enum oak_stage0::hal::PageAssignment">PageAssignment</a>)</h4></section></summary><div class="docblock"><p>Ask for the page state to be changed by the hypervisor.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.revalidate_page" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#148">source</a><h4 class="code-header">fn <a href="#tymethod.revalidate_page" class="fn">revalidate_page</a>(page: Page&lt;Size4KiB&gt;)</h4></section></summary><div class="docblock"><p>Validate one page of memory.</p>
<p>This operation is required for SEV after going from a SHARED state to a
PRIVATE state.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.page_table_mask" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#154">source</a><h4 class="code-header">fn <a href="#tymethod.page_table_mask" class="fn">page_table_mask</a>(encryption_state: <a class="enum" href="../paging/enum.PageEncryption.html" title="enum oak_stage0::paging::PageEncryption">PageEncryption</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a></h4></section></summary><div class="docblock"><p>Mask to use in the page tables for the given encrypion state.</p>
<p>SEV and TDX have opposite behaviours: for SEV, encrypted pages are
marked; for TDX, unencrypted pages are marked.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.encrypted" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#157">source</a><h4 class="code-header">fn <a href="#tymethod.encrypted" class="fn">encrypted</a>() -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a></h4></section></summary><div class="docblock"><p>Encrypted/shared bit mask irrespective of its semantics.</p>
</div></details><section id="tymethod.tee_platform" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#159">source</a><h4 class="code-header">fn <a href="#tymethod.tee_platform" class="fn">tee_platform</a>() -&gt; TeePlatform</h4></section><details class="toggle method-toggle" open><summary><section id="tymethod.read_msr" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#166">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.read_msr" class="fn">read_msr</a>(msr: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u32.html">u32</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a></h4></section></summary><div class="docblock"><p>Read a MSR.</p>
<h6 id="safety"><a class="doc-anchor" href="#safety">§</a>Safety</h6>
<p>The caller must guarantee that the MSR is valid.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.write_msr" class="method"><a class="src rightside" href="../../src/oak_stage0/hal/mod.rs.html#173">source</a><h4 class="code-header">unsafe fn <a href="#tymethod.write_msr" class="fn">write_msr</a>(msr: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u32.html">u32</a>, value: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.u64.html">u64</a>)</h4></section></summary><div class="docblock"><p>Write to a MSR.</p>
<h6 id="safety-1"><a class="doc-anchor" href="#safety-1">§</a>Safety</h6>
<p>The caller must guarantee that the MSR is valid.</p>
</div></details></div><h2 id="object-safety" class="section-header">Object Safety<a href="#object-safety" class="anchor">§</a></h2><div class="object-safety-info">This trait is <b>not</b> <a href="https://doc.rust-lang.org/nightly/reference/items/traits.html#object-safety">object safe</a>.</div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><details class="toggle implementors-toggle"><summary><section id="impl-Platform-for-Base" class="impl"><a class="src rightside" href="../../src/oak_stage0/hal/base/mod.rs.html#39-114">source</a><a href="#impl-Platform-for-Base" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Platform.html" title="trait oak_stage0::hal::Platform">Platform</a> for <a class="struct" href="struct.Base.html" title="struct oak_stage0::hal::Base">Base</a></h3></section></summary><div class="impl-items"><section id="associatedtype.Mmio-1" class="associatedtype trait-impl"><a href="#associatedtype.Mmio-1" class="anchor">§</a><h4 class="code-header">type <a href="#associatedtype.Mmio" class="associatedtype">Mmio</a>&lt;S: PageSize&gt; = Mmio&lt;S&gt;</h4></section></div></details><details class="toggle implementors-toggle"><summary><section id="impl-Platform-for-Sev" class="impl"><a class="src rightside" href="../../src/oak_stage0/hal/sev/mod.rs.html#144-327">source</a><a href="#impl-Platform-for-Sev" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Platform.html" title="trait oak_stage0::hal::Platform">Platform</a> for <a class="struct" href="struct.Sev.html" title="struct oak_stage0::hal::Sev">Sev</a></h3></section></summary><div class="impl-items"><section id="associatedtype.Mmio-2" class="associatedtype trait-impl"><a href="#associatedtype.Mmio-2" class="anchor">§</a><h4 class="code-header">type <a href="#associatedtype.Mmio" class="associatedtype">Mmio</a>&lt;S: PageSize&gt; = Mmio&lt;S&gt;</h4></section></div></details></div><script src="../../trait.impl/oak_stage0/hal/trait.Platform.js" async></script></section></div></main></body></html>