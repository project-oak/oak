<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Rust implementations of the AMD SEV-SNP GHCB MSR protocol."><title>oak_sev_guest::msr - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-9ee3a5e31a2afa3e.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="oak_sev_guest" data-themes="" data-resource-suffix="" data-rustdoc-version="1.76.0-nightly (dd430bc8c 2023-11-14)" data-channel="nightly" data-search-js="search-8fbf244ebcf71464.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-f06f02fd918e3bb3.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../oak_sev_guest/index.html">oak_sev_guest</a><span class="version">0.1.0</span></h2></div><h2 class="location"><a href="#">Module msr</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In crate oak_sev_guest</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">oak_sev_guest</a>::<wbr><a class="mod" href="#">msr</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/oak_sev_guest/msr.rs.html#17-816">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Rust implementations of the AMD SEV-SNP GHCB MSR protocol.</p>
<p>The protocol is implemented by writing to, and reading from, model-specific register (MSR)
0xC001_0130. The guest makes a request by writing an appropriate value to the MSR and calling
VMGEXIT. After the hypervisor processes the request and resumes the guest, the guest can read
the response from the same MSR.</p>
<p>The 12 least significant bits represent information about the operation being performed. The
remaining 52 bits represent the data for the operation. The format of the data is dependent on
the operation.</p>
<p>The MSR protocol is primarily used to set up the GHCB communications with the hypervisor.</p>
<p>See section 2.3.1 in <a href="https://www.amd.com/system/files/TechDocs/56421-guest-hypervisor-communication-block-standardization.pdf">https://www.amd.com/system/files/TechDocs/56421-guest-hypervisor-communication-block-standardization.pdf</a> for more detail.</p>
<p>Note: This implementation does not include the AP Reset Hold operations seeing that it is not
the preferred mechanism for starting a new application processor (AP) under AMD SEV-SNP. The
SEV-SNP AP creation NAE should be used instead. See section 4.3.2 of
<a href="https://www.amd.com/system/files/TechDocs/56421-guest-hypervisor-communication-block-standardization.pdf">https://www.amd.com/system/files/TechDocs/56421-guest-hypervisor-communication-block-standardization.pdf</a>.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.ApResetHoldRequest.html" title="struct oak_sev_guest::msr::ApResetHoldRequest">ApResetHoldRequest</a></div></li><li><div class="item-name"><a class="struct" href="struct.ApResetHoldResponse.html" title="struct oak_sev_guest::msr::ApResetHoldResponse">ApResetHoldResponse</a></div></li><li><div class="item-name"><a class="struct" href="struct.CpuidRequest.html" title="struct oak_sev_guest::msr::CpuidRequest">CpuidRequest</a></div><div class="desc docblock-short">A request to execute CPUID for a specific leaf and return one of the result registers.</div></li><li><div class="item-name"><a class="struct" href="struct.CpuidResponse.html" title="struct oak_sev_guest::msr::CpuidResponse">CpuidResponse</a></div><div class="desc docblock-short">A response from executing CPUID for a specific leaf. Only one register is returned at a time.</div></li><li><div class="item-name"><a class="struct" href="struct.GhcbGpa.html" title="struct oak_sev_guest::msr::GhcbGpa">GhcbGpa</a></div><div class="desc docblock-short">Contains the guest-physical address of the GHCB page. The address must have been registered with
the hypervisor before using it.</div></li><li><div class="item-name"><a class="struct" href="struct.HypervisorFeatureSupportRequest.html" title="struct oak_sev_guest::msr::HypervisorFeatureSupportRequest">HypervisorFeatureSupportRequest</a></div><div class="desc docblock-short">A request for the hypervisor’s supported features.</div></li><li><div class="item-name"><a class="struct" href="struct.HypervisorFeatureSupportResponse.html" title="struct oak_sev_guest::msr::HypervisorFeatureSupportResponse">HypervisorFeatureSupportResponse</a></div><div class="desc docblock-short">Flags indicating which features are supported by the hypervisor.</div></li><li><div class="item-name"><a class="struct" href="struct.PreferredGhcbGpaRequest.html" title="struct oak_sev_guest::msr::PreferredGhcbGpaRequest">PreferredGhcbGpaRequest</a></div><div class="desc docblock-short">A request for the hypervisor’s preferred location for the GHCB page.</div></li><li><div class="item-name"><a class="struct" href="struct.PreferredGhcbGpaResponse.html" title="struct oak_sev_guest::msr::PreferredGhcbGpaResponse">PreferredGhcbGpaResponse</a></div><div class="desc docblock-short">The response containing the preferred location of the GHCB.</div></li><li><div class="item-name"><a class="struct" href="struct.RegisterGhcbGpaRequest.html" title="struct oak_sev_guest::msr::RegisterGhcbGpaRequest">RegisterGhcbGpaRequest</a></div><div class="desc docblock-short">Request to register a guest-physical address for the GHCB with the hypervisor.</div></li><li><div class="item-name"><a class="struct" href="struct.RegisterGhcbGpaResponse.html" title="struct oak_sev_guest::msr::RegisterGhcbGpaResponse">RegisterGhcbGpaResponse</a></div><div class="desc docblock-short">The response containing the result of the GHCB registration.</div></li><li><div class="item-name"><a class="struct" href="struct.SevInfoRequest.html" title="struct oak_sev_guest::msr::SevInfoRequest">SevInfoRequest</a></div><div class="desc docblock-short">A request for information about the supported GHCB MSR protocol version and the encryption bit.</div></li><li><div class="item-name"><a class="struct" href="struct.SevInfoResponse.html" title="struct oak_sev_guest::msr::SevInfoResponse">SevInfoResponse</a></div><div class="desc docblock-short">Response from the hypervisor about the encryption bit and supported GHCB protocol versions. The
encryption bit value is validated by the hardware before the guest is resumed.</div></li><li><div class="item-name"><a class="struct" href="struct.SevStatus.html" title="struct oak_sev_guest::msr::SevStatus">SevStatus</a></div><div class="desc docblock-short">Flags indicating which SEV features are active.</div></li><li><div class="item-name"><a class="struct" href="struct.SnpPageStateChangeRequest.html" title="struct oak_sev_guest::msr::SnpPageStateChangeRequest">SnpPageStateChangeRequest</a></div><div class="desc docblock-short">Request to change a memory page from shared to private or private to shared.</div></li><li><div class="item-name"><a class="struct" href="struct.SnpPageStateChangeResponse.html" title="struct oak_sev_guest::msr::SnpPageStateChangeResponse">SnpPageStateChangeResponse</a></div><div class="desc docblock-short">The response containing the result of the SNP Page State Change operation.</div></li><li><div class="item-name"><a class="struct" href="struct.TerminationRequest.html" title="struct oak_sev_guest::msr::TerminationRequest">TerminationRequest</a></div><div class="desc docblock-short">Request for the hypervisor to terminate the guest.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.CpuidRegister.html" title="enum oak_sev_guest::msr::CpuidRegister">CpuidRegister</a></div><div class="desc docblock-short">The register of interest from the result of executing CPUID.</div></li><li><div class="item-name"><a class="enum" href="enum.PageAssignment.html" title="enum oak_sev_guest::msr::PageAssignment">PageAssignment</a></div><div class="desc docblock-short">Whether a memory page is private to the guest, or shared with the hypervisor.</div></li><li><div class="item-name"><a class="enum" href="enum.RegisterGhcbGpaError.html" title="enum oak_sev_guest::msr::RegisterGhcbGpaError">RegisterGhcbGpaError</a></div></li><li><div class="item-name"><a class="enum" href="enum.SevStatusError.html" title="enum oak_sev_guest::msr::SevStatusError">SevStatusError</a></div></li><li><div class="item-name"><a class="enum" href="enum.TerminationReason.html" title="enum oak_sev_guest::msr::TerminationReason">TerminationReason</a></div><div class="desc docblock-short">The reason for requesting termination from the hypervisor.</div></li></ul><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.NO_PREFERRED_GHCB_LOCATION.html" title="constant oak_sev_guest::msr::NO_PREFERRED_GHCB_LOCATION">NO_PREFERRED_GHCB_LOCATION</a></div><div class="desc docblock-short">Value indicating that the hypervisor does not have a preferred location for the GHCB.</div></li><li><div class="item-name"><a class="constant" href="constant.SUPPORTED_PROTOCOL_VERSION.html" title="constant oak_sev_guest::msr::SUPPORTED_PROTOCOL_VERSION">SUPPORTED_PROTOCOL_VERSION</a></div><div class="desc docblock-short">The version of the GHCB MSR protocol supported by this library. This represents the version
specific to AMD SEV-SNP.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.ap_reset_hold.html" title="fn oak_sev_guest::msr::ap_reset_hold">ap_reset_hold</a></div></li><li><div class="item-name"><a class="fn" href="fn.change_snp_page_state.html" title="fn oak_sev_guest::msr::change_snp_page_state">change_snp_page_state</a></div><div class="desc docblock-short">Requests a change of state for a page to be either private to the guest VM, or shared with the
hypervisor.</div></li><li><div class="item-name"><a class="fn" href="fn.change_snp_state_for_frame.html" title="fn oak_sev_guest::msr::change_snp_state_for_frame">change_snp_state_for_frame</a></div><div class="desc docblock-short">Changes the SNP page state assignments in the RMP for a 2MiB physical frame.</div></li><li><div class="item-name"><a class="fn" href="fn.get_cpuid.html" title="fn oak_sev_guest::msr::get_cpuid">get_cpuid</a></div><div class="desc docblock-short">Gets the value of the specified register that was returned when executing CPUID for the
specified leaf. Sub-leafs are not supported.</div></li><li><div class="item-name"><a class="fn" href="fn.get_cpuid_for_vc_exception.html" title="fn oak_sev_guest::msr::get_cpuid_for_vc_exception">get_cpuid_for_vc_exception</a></div><div class="desc docblock-short">Gets the CPUID values for EAX, EBX, ECX and EDX and updates the interrupt stackframe with these.</div></li><li><div class="item-name"><a class="fn" href="fn.get_hypervisor_feature_support.html" title="fn oak_sev_guest::msr::get_hypervisor_feature_support">get_hypervisor_feature_support</a></div><div class="desc docblock-short">Requests a bitmap specifying the features supported by the hypervisor.</div></li><li><div class="item-name"><a class="fn" href="fn.get_preferred_ghcb_location.html" title="fn oak_sev_guest::msr::get_preferred_ghcb_location">get_preferred_ghcb_location</a></div><div class="desc docblock-short">Requests the hypervisor’s preferred location for the GHCB page.</div></li><li><div class="item-name"><a class="fn" href="fn.get_sev_info.html" title="fn oak_sev_guest::msr::get_sev_info">get_sev_info</a></div><div class="desc docblock-short">Gets information about the supported GHCB MSR protocol versions and the location of the
encryption bit.</div></li><li><div class="item-name"><a class="fn" href="fn.get_sev_status.html" title="fn oak_sev_guest::msr::get_sev_status">get_sev_status</a></div><div class="desc docblock-short">Gets the status of SEV features for the current guest.</div></li><li><div class="item-name"><a class="fn" href="fn.register_ghcb_location.html" title="fn oak_sev_guest::msr::register_ghcb_location">register_ghcb_location</a></div><div class="desc docblock-short">Registers the location of the GHCB page for the current vCPU with the hypervisor.</div></li><li><div class="item-name"><a class="fn" href="fn.request_termination.html" title="fn oak_sev_guest::msr::request_termination">request_termination</a></div><div class="desc docblock-short">Requests termination from the hypervisor.</div></li><li><div class="item-name"><a class="fn" href="fn.set_ghcb_address_and_exit.html" title="fn oak_sev_guest::msr::set_ghcb_address_and_exit">set_ghcb_address_and_exit</a></div><div class="desc docblock-short">Sets the address of the GHCB page before exiting to the hypervisor.</div></li></ul></section></div></main></body></html>