<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Rust implementations of the AMD SEV-SNP GHCB MSR protocol."><title>oak_sev_guest::msr - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-fecee23daa4e8a6d.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="oak_sev_guest" data-themes="" data-resource-suffix="" data-rustdoc-version="1.83.0-nightly (4ac7bcbaa 2024-09-04)" data-channel="nightly" data-search-js="search-a99f1315e7cc5121.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-921df33f47b8780c.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-3b12f09e550e0385.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../oak_sev_guest/index.html">oak_<wbr>sev_<wbr>guest</a><span class="version">0.1.0</span></h2></div><h2 class="location"><a href="#">Module msr</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In crate oak_<wbr>sev_<wbr>guest</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">oak_sev_guest</a>::<wbr><a class="mod" href="#">msr</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/oak_sev_guest/msr.rs.html#17-802">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Rust implementations of the AMD SEV-SNP GHCB MSR protocol.</p>
<p>The protocol is implemented by writing to, and reading from, model-specific
register (MSR) 0xC001_0130. The guest makes a request by writing an
appropriate value to the MSR and calling VMGEXIT. After the hypervisor
processes the request and resumes the guest, the guest can read the response
from the same MSR.</p>
<p>The 12 least significant bits represent information about the operation
being performed. The remaining 52 bits represent the data for the operation.
The format of the data is dependent on the operation.</p>
<p>The MSR protocol is primarily used to set up the GHCB communications with
the hypervisor.</p>
<p>See section 2.3.1 in <a href="https://www.amd.com/system/files/TechDocs/56421-guest-hypervisor-communication-block-standardization.pdf">https://www.amd.com/system/files/TechDocs/56421-guest-hypervisor-communication-block-standardization.pdf</a> for more detail.</p>
<p>Note: This implementation does not include the AP Reset Hold operations
seeing that it is not the preferred mechanism for starting a new application
processor (AP) under AMD SEV-SNP. The SEV-SNP AP creation NAE should be used
instead. See section 4.3.2 of <a href="https://www.amd.com/system/files/TechDocs/56421-guest-hypervisor-communication-block-standardization.pdf">https://www.amd.com/system/files/TechDocs/56421-guest-hypervisor-communication-block-standardization.pdf</a>.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.ApResetHoldRequest.html" title="struct oak_sev_guest::msr::ApResetHoldRequest">ApReset<wbr>Hold<wbr>Request</a></div></li><li><div class="item-name"><a class="struct" href="struct.ApResetHoldResponse.html" title="struct oak_sev_guest::msr::ApResetHoldResponse">ApReset<wbr>Hold<wbr>Response</a></div></li><li><div class="item-name"><a class="struct" href="struct.CpuidRequest.html" title="struct oak_sev_guest::msr::CpuidRequest">Cpuid<wbr>Request</a></div><div class="desc docblock-short">A request to execute CPUID for a specific leaf and return one of the result
registers.</div></li><li><div class="item-name"><a class="struct" href="struct.CpuidResponse.html" title="struct oak_sev_guest::msr::CpuidResponse">Cpuid<wbr>Response</a></div><div class="desc docblock-short">A response from executing CPUID for a specific leaf. Only one register is
returned at a time.</div></li><li><div class="item-name"><a class="struct" href="struct.GhcbGpa.html" title="struct oak_sev_guest::msr::GhcbGpa">GhcbGpa</a></div><div class="desc docblock-short">Contains the guest-physical address of the GHCB page. The address must have
been registered with the hypervisor before using it.</div></li><li><div class="item-name"><a class="struct" href="struct.HypervisorFeatureSupportRequest.html" title="struct oak_sev_guest::msr::HypervisorFeatureSupportRequest">Hypervisor<wbr>Feature<wbr>Support<wbr>Request</a></div><div class="desc docblock-short">A request for the hypervisor’s supported features.</div></li><li><div class="item-name"><a class="struct" href="struct.HypervisorFeatureSupportResponse.html" title="struct oak_sev_guest::msr::HypervisorFeatureSupportResponse">Hypervisor<wbr>Feature<wbr>Support<wbr>Response</a></div><div class="desc docblock-short">Flags indicating which features are supported by the hypervisor.</div></li><li><div class="item-name"><a class="struct" href="struct.PreferredGhcbGpaRequest.html" title="struct oak_sev_guest::msr::PreferredGhcbGpaRequest">Preferred<wbr>Ghcb<wbr>GpaRequest</a></div><div class="desc docblock-short">A request for the hypervisor’s preferred location for the GHCB page.</div></li><li><div class="item-name"><a class="struct" href="struct.PreferredGhcbGpaResponse.html" title="struct oak_sev_guest::msr::PreferredGhcbGpaResponse">Preferred<wbr>Ghcb<wbr>GpaResponse</a></div><div class="desc docblock-short">The response containing the preferred location of the GHCB.</div></li><li><div class="item-name"><a class="struct" href="struct.RegisterGhcbGpaRequest.html" title="struct oak_sev_guest::msr::RegisterGhcbGpaRequest">Register<wbr>Ghcb<wbr>GpaRequest</a></div><div class="desc docblock-short">Request to register a guest-physical address for the GHCB with the
hypervisor.</div></li><li><div class="item-name"><a class="struct" href="struct.RegisterGhcbGpaResponse.html" title="struct oak_sev_guest::msr::RegisterGhcbGpaResponse">Register<wbr>Ghcb<wbr>GpaResponse</a></div><div class="desc docblock-short">The response containing the result of the GHCB registration.</div></li><li><div class="item-name"><a class="struct" href="struct.SevInfoRequest.html" title="struct oak_sev_guest::msr::SevInfoRequest">SevInfo<wbr>Request</a></div><div class="desc docblock-short">A request for information about the supported GHCB MSR protocol version and
the encryption bit.</div></li><li><div class="item-name"><a class="struct" href="struct.SevInfoResponse.html" title="struct oak_sev_guest::msr::SevInfoResponse">SevInfo<wbr>Response</a></div><div class="desc docblock-short">Response from the hypervisor about the encryption bit and supported GHCB
protocol versions. The encryption bit value is validated by the hardware
before the guest is resumed.</div></li><li><div class="item-name"><a class="struct" href="struct.SevStatus.html" title="struct oak_sev_guest::msr::SevStatus">SevStatus</a></div><div class="desc docblock-short">Flags indicating which SEV features are active.</div></li><li><div class="item-name"><a class="struct" href="struct.SnpPageStateChangeRequest.html" title="struct oak_sev_guest::msr::SnpPageStateChangeRequest">SnpPage<wbr>State<wbr>Change<wbr>Request</a></div><div class="desc docblock-short">Request to change a memory page from shared to private or private to shared.</div></li><li><div class="item-name"><a class="struct" href="struct.SnpPageStateChangeResponse.html" title="struct oak_sev_guest::msr::SnpPageStateChangeResponse">SnpPage<wbr>State<wbr>Change<wbr>Response</a></div><div class="desc docblock-short">The response containing the result of the SNP Page State Change operation.</div></li><li><div class="item-name"><a class="struct" href="struct.TerminationRequest.html" title="struct oak_sev_guest::msr::TerminationRequest">Termination<wbr>Request</a></div><div class="desc docblock-short">Request for the hypervisor to terminate the guest.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.CpuidRegister.html" title="enum oak_sev_guest::msr::CpuidRegister">Cpuid<wbr>Register</a></div><div class="desc docblock-short">The register of interest from the result of executing CPUID.</div></li><li><div class="item-name"><a class="enum" href="enum.PageAssignment.html" title="enum oak_sev_guest::msr::PageAssignment">Page<wbr>Assignment</a></div><div class="desc docblock-short">Whether a memory page is private to the guest, or shared with the
hypervisor.</div></li><li><div class="item-name"><a class="enum" href="enum.RegisterGhcbGpaError.html" title="enum oak_sev_guest::msr::RegisterGhcbGpaError">Register<wbr>Ghcb<wbr>GpaError</a></div></li><li><div class="item-name"><a class="enum" href="enum.SevStatusError.html" title="enum oak_sev_guest::msr::SevStatusError">SevStatus<wbr>Error</a></div></li><li><div class="item-name"><a class="enum" href="enum.TerminationReason.html" title="enum oak_sev_guest::msr::TerminationReason">Termination<wbr>Reason</a></div><div class="desc docblock-short">The reason for requesting termination from the hypervisor.</div></li></ul><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.NO_PREFERRED_GHCB_LOCATION.html" title="constant oak_sev_guest::msr::NO_PREFERRED_GHCB_LOCATION">NO_<wbr>PREFERRE<wbr>D_<wbr>GHCB_<wbr>LOCATION</a></div><div class="desc docblock-short">Value indicating that the hypervisor does not have a preferred location for
the GHCB.</div></li><li><div class="item-name"><a class="constant" href="constant.SUPPORTED_PROTOCOL_VERSION.html" title="constant oak_sev_guest::msr::SUPPORTED_PROTOCOL_VERSION">SUPPORTE<wbr>D_<wbr>PROTOCO<wbr>L_<wbr>VERSION</a></div><div class="desc docblock-short">The version of the GHCB MSR protocol supported by this library. This
represents the version specific to AMD SEV-SNP.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.ap_reset_hold.html" title="fn oak_sev_guest::msr::ap_reset_hold">ap_<wbr>reset_<wbr>hold</a></div></li><li><div class="item-name"><a class="fn" href="fn.change_snp_page_state.html" title="fn oak_sev_guest::msr::change_snp_page_state">change_<wbr>snp_<wbr>page_<wbr>state</a></div><div class="desc docblock-short">Requests a change of state for a page to be either private to the guest VM,
or shared with the hypervisor.</div></li><li><div class="item-name"><a class="fn" href="fn.change_snp_state_for_frame.html" title="fn oak_sev_guest::msr::change_snp_state_for_frame">change_<wbr>snp_<wbr>state_<wbr>for_<wbr>frame</a></div><div class="desc docblock-short">Changes the SNP page state assignments in the RMP for a 2MiB physical frame.</div></li><li><div class="item-name"><a class="fn" href="fn.get_cpuid.html" title="fn oak_sev_guest::msr::get_cpuid">get_<wbr>cpuid</a></div><div class="desc docblock-short">Gets the value of the specified register that was returned when executing
CPUID for the specified leaf. Sub-leafs are not supported.</div></li><li><div class="item-name"><a class="fn" href="fn.get_cpuid_for_vc_exception.html" title="fn oak_sev_guest::msr::get_cpuid_for_vc_exception">get_<wbr>cpuid_<wbr>for_<wbr>vc_<wbr>exception</a></div><div class="desc docblock-short">Gets the CPUID values for EAX, EBX, ECX and EDX and updates the interrupt
stackframe with these.</div></li><li><div class="item-name"><a class="fn" href="fn.get_hypervisor_feature_support.html" title="fn oak_sev_guest::msr::get_hypervisor_feature_support">get_<wbr>hypervisor_<wbr>feature_<wbr>support</a></div><div class="desc docblock-short">Requests a bitmap specifying the features supported by the hypervisor.</div></li><li><div class="item-name"><a class="fn" href="fn.get_preferred_ghcb_location.html" title="fn oak_sev_guest::msr::get_preferred_ghcb_location">get_<wbr>preferred_<wbr>ghcb_<wbr>location</a></div><div class="desc docblock-short">Requests the hypervisor’s preferred location for the GHCB page.</div></li><li><div class="item-name"><a class="fn" href="fn.get_sev_info.html" title="fn oak_sev_guest::msr::get_sev_info">get_<wbr>sev_<wbr>info</a></div><div class="desc docblock-short">Gets information about the supported GHCB MSR protocol versions and the
location of the encryption bit.</div></li><li><div class="item-name"><a class="fn" href="fn.get_sev_status.html" title="fn oak_sev_guest::msr::get_sev_status">get_<wbr>sev_<wbr>status</a></div><div class="desc docblock-short">Gets the status of SEV features for the current guest.</div></li><li><div class="item-name"><a class="fn" href="fn.register_ghcb_location.html" title="fn oak_sev_guest::msr::register_ghcb_location">register_<wbr>ghcb_<wbr>location</a></div><div class="desc docblock-short">Registers the location of the GHCB page for the current vCPU with the
hypervisor.</div></li><li><div class="item-name"><a class="fn" href="fn.request_termination.html" title="fn oak_sev_guest::msr::request_termination">request_<wbr>termination</a></div><div class="desc docblock-short">Requests termination from the hypervisor.</div></li><li><div class="item-name"><a class="fn" href="fn.set_ghcb_address_and_exit.html" title="fn oak_sev_guest::msr::set_ghcb_address_and_exit">set_<wbr>ghcb_<wbr>address_<wbr>and_<wbr>exit</a></div><div class="desc docblock-short">Sets the address of the GHCB page before exiting to the hypervisor.</div></li></ul></section></div></main></body></html>