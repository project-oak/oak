// File automatically generated by `oak_idl_gen_services`, do not edit.
// Original service name: TestService

extern crate alloc;

use alloc::{format, string::ToString};

pub struct TestServiceClient<T: oak_idl::Handler> {
    handler: T
}

impl <T: oak_idl::Handler>TestServiceClient<T> {
    pub fn new(handler: T) -> Self {
        Self {
            handler
        }
    }
    pub fn lookup_data(&mut self, request_body: &[u8]) -> Result<oak_idl::utils::OwnedFlatbuffer<LookupDataResponse>, oak_idl::Status> {
        flatbuffers::root::<LookupDataRequest>(request_body).map_err(|err| oak_idl::Status::new_with_message(oak_idl::StatusCode::Internal, format!("Client failed to deserialize the request: {:?}", err)))?;
        let request = oak_idl::Request {
            method_id: 222,
            body: request_body,
        };
        let response_body = self.handler.invoke(request)?;
        oak_idl::utils::OwnedFlatbuffer::from_vec(response_body).map_err(|err| oak_idl::Status::new_with_message(oak_idl::StatusCode::Internal, format!("Client failed to deserialize the response: {:?}", err)))
    }
    pub fn log(&mut self, request_body: &[u8]) -> Result<oak_idl::utils::OwnedFlatbuffer<LogResponse>, oak_idl::Status> {
        flatbuffers::root::<LogRequest>(request_body).map_err(|err| oak_idl::Status::new_with_message(oak_idl::StatusCode::Internal, format!("Client failed to deserialize the request: {:?}", err)))?;
        let request = oak_idl::Request {
            method_id: 223,
            body: request_body,
        };
        let response_body = self.handler.invoke(request)?;
        oak_idl::utils::OwnedFlatbuffer::from_vec(response_body).map_err(|err| oak_idl::Status::new_with_message(oak_idl::StatusCode::Internal, format!("Client failed to deserialize the response: {:?}", err)))
    }
}

pub struct TestServiceServer<S> {
    service: S
}

impl <S: TestService> oak_idl::Handler for TestServiceServer<S> {
    fn invoke(&mut self, request: oak_idl::Request) -> Result<alloc::vec::Vec<u8>, oak_idl::Status> {
        match request.method_id {
            222 => {
                let request = flatbuffers::root::<LookupDataRequest>(request.body).map_err(|err| oak_idl::Status::new_with_message(oak_idl::StatusCode::Internal, format!("Service failed to deserialize the request: {:?}", err)))?;
                let response = self.service.lookup_data(&request)?;
                let response_body = response.into_vec();
                Ok(response_body)
            }
            223 => {
                let request = flatbuffers::root::<LogRequest>(request.body).map_err(|err| oak_idl::Status::new_with_message(oak_idl::StatusCode::Internal, format!("Service failed to deserialize the request: {:?}", err)))?;
                let response = self.service.log(&request)?;
                let response_body = response.into_vec();
                Ok(response_body)
            }
            _ => Err(oak_idl::Status::new(oak_idl::StatusCode::Unimplemented))
        }
    }
}

pub trait TestService: Sized {
    fn lookup_data(&mut self, request: &LookupDataRequest) -> Result<oak_idl::utils::OwnedFlatbuffer<LookupDataResponse>, oak_idl::Status>;
    fn log(&mut self, request: &LogRequest) -> Result<oak_idl::utils::OwnedFlatbuffer<LogResponse>, oak_idl::Status>;
    fn serve(self) -> TestServiceServer<Self> {
        TestServiceServer { service : self }
    }
}
