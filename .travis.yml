language: shell

services:
  - docker

cache:
  timeout: 600
  directories:
    - bazel-cache  # explicit cache directory for Docker Bazel builds (scripts/docker_run)
    - .cache/bazel  # default cache directory for local Bazel builds
    - rust/target  # cached objects for Rust library code
    - examples/target  # cached objects for Rust example code

jobs:
  include:
    - name: build
      script:
      - ./scripts/docker_run ./scripts/check_formatting
      - ./scripts/run_examples
      - ./scripts/docker_run ./scripts/check_generated
    - name: test
      script:
      - ./scripts/docker_run ./scripts/build_server
      - ./scripts/docker_run ./scripts/build_dev_server
      - ./scripts/docker_run ./scripts/run_tests
